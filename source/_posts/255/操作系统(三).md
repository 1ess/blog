---
title: 操作系统(三)
featured_image: https://cdn-fawn.vercel.app/blogImg/Blog255.jpg
date: 2023/04/13
---

## 进程之间切换
***  
### 协作式多任务切换
过去某些系统采用协作(**cooperative**)方式来进行进程切换。在这种方式下，操作系统相信运行的进程会合理运行，进程会定期放弃 CPU，以便操作系统可以决定运行其他任务。
多数进程通过进行系统调用，将 CPU 的控制权转移给操作系统。也就是说在协作调度系统中，操作系统通过等待系统调用或某种非法操作发生，从而重新获得 CPU 的控制权。

### 抢占式多任务切换
如果没有硬件的额外帮助，如果进程拒绝进行系统调用也不出错，从而将控制权交还给操作系统，那么操作系统永远无法再次获得 CPU 的控制权。在协作式多任务切换中，当进程陷入无限循环时，唯一的办法就是重启。

如何在没有协作的情况下获得控制权呢，时钟中断(**timer interrupt**)可以解决这个棘手的问题。时钟设备可以编程为每隔几毫秒产生一次中断。产生中断时，当前正在运行的进程停止，操作系统中预先配置的中断处理程序(**interrupt handler**)会运行。此时，操作系统会重新获得 CPU 的控制权。

### 保存/恢复上下文
操作系统重新获得控制权后，都必须决定是继续运行当前正在运行的进程，还是切换到另一个进程。这个决定是由调度程序(**scheduler**)决定的。
如果决定进行切换，操作系统就会执行一些底层代码，即上下文切换(**context switch**)。  
对于上下文切换，指的是操作系统为当前正在执行的进程保存一些寄存器的值到它的内核栈，并为即将执行的进程从它的内核栈恢复一些寄存器的值。